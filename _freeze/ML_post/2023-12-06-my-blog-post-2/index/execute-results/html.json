{
  "hash": "30f2bff5b80451cd56eb4653e9d180e9",
  "result": {
    "markdown": "---\ntitle: \"Clustering\"\ndescription: \"ML assignment blog 2\"\ndate: 2023-12-02\ncategories: [Machine Learning] \ndraft: false\n---\n\n\n## 1. Data\n\nFor clustering using K-means, we use the freely available USArrests dataset. We aim to cluster the states of US based on the crimes from the USAressts data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(skimr)\n\ndata(\"USArrests\")\n\n\nskim(USArrests)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |          |\n|:------------------------|:---------|\n|Name                     |USArrests |\n|Number of rows           |50        |\n|Number of columns        |4         |\n|_______________________  |          |\n|Column type frequency:   |          |\n|numeric                  |4         |\n|________________________ |          |\n|Group variables          |None      |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|    sd|   p0|    p25|    p50|    p75|  p100|hist  |\n|:-------------|---------:|-------------:|------:|-----:|----:|------:|------:|------:|-----:|:-----|\n|Murder        |         0|             1|   7.79|  4.36|  0.8|   4.08|   7.25|  11.25|  17.4|▇▇▅▅▃ |\n|Assault       |         0|             1| 170.76| 83.34| 45.0| 109.00| 159.00| 249.00| 337.0|▆▇▃▅▃ |\n|UrbanPop      |         0|             1|  65.54| 14.47| 32.0|  54.50|  66.00|  77.75|  91.0|▁▆▇▅▆ |\n|Rape          |         0|             1|  21.23|  9.37|  7.3|  15.08|  20.10|  26.17|  46.0|▆▇▅▂▂ |\n:::\n\n```{.r .cell-code}\nhead(USArrests)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           Murder Assault UrbanPop Rape\nAlabama      13.2     236       58 21.2\nAlaska       10.0     263       48 44.5\nArizona       8.1     294       80 31.0\nArkansas      8.8     190       50 19.5\nCalifornia    9.0     276       91 40.6\nColorado      7.9     204       78 38.7\n```\n:::\n:::\n\n\n## 2. Identify and remove variables with high correlation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(GGally)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: ggplot2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'GGally':\n  method from   \n  +.gg   ggplot2\n```\n:::\n\n```{.r .cell-code}\nggpairs(\n  \n  data = USArrests,\n  columns = c(1:4))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nFrom the analysis, we see that there's a high correlation between murder and assault. So, we have to remove either one of them. Here, we remove murder for the further clustering analysis.\n\n## 3. Scale the variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Scale\n\ndata_scaled = scale(USArrests)\n\nhead(data_scaled)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Murder   Assault   UrbanPop         Rape\nAlabama    1.24256408 0.7828393 -0.5209066 -0.003416473\nAlaska     0.50786248 1.1068225 -1.2117642  2.484202941\nArizona    0.07163341 1.4788032  0.9989801  1.042878388\nArkansas   0.23234938 0.2308680 -1.0735927 -0.184916602\nCalifornia 0.27826823 1.2628144  1.7589234  2.067820292\nColorado   0.02571456 0.3988593  0.8608085  1.864967207\n```\n:::\n\n```{.r .cell-code}\ndata_selected = data_scaled[, 2:4]\n\nhead(data_selected)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Assault   UrbanPop         Rape\nAlabama    0.7828393 -0.5209066 -0.003416473\nAlaska     1.1068225 -1.2117642  2.484202941\nArizona    1.4788032  0.9989801  1.042878388\nArkansas   0.2308680 -1.0735927 -0.184916602\nCalifornia 1.2628144  1.7589234  2.067820292\nColorado   0.3988593  0.8608085  1.864967207\n```\n:::\n:::\n\n\n## 4. Required packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cluster)\nlibrary(factoextra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWelcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n\nset.seed(123)\ncrime = sample(1:50, 10)\n\ncrime_1 = data_selected[crime,]\n\nhead(crime_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Assault    UrbanPop        Rape\nNew Mexico  1.3708088  0.30812248  1.16031965\nIowa       -1.3770485 -0.58999237 -1.06038781\nIndiana    -0.6930840 -0.03730631 -0.02476943\nArizona     1.4788032  0.99898006  1.04287839\nTennessee   0.2068693 -0.45182086  0.60514278\nTexas       0.3628612  0.99898006  0.45567209\n```\n:::\n:::\n\n\n## 5. Euclidean Distance\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndist_eucli = dist(crime_1, method = \"euclidean\")\n\nhead(dist_eucli)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3.6453905 2.4048723 0.7090412 1.4968268 1.4105924 1.5550653\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nround(as.matrix(dist_eucli)[1:4, 1:4], 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           New Mexico Iowa Indiana Arizona\nNew Mexico        0.0  3.6     2.4     0.7\nIowa              3.6  0.0     1.4     3.9\nIndiana           2.4  1.4     0.0     2.6\nArizona           0.7  3.9     2.6     0.0\n```\n:::\n\n```{.r .cell-code}\nfviz_dist(dist_eucli)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## 6. Optimal number of clusters\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Elbow method\nfviz_nbclust(data_selected, kmeans, method = 'wss') +\n             geom_vline(xintercept = 4, linetype=5, col= \"green\")+\n    labs(subtitle = \"Elbow method\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Silhouette method\nfviz_nbclust(data_selected, kmeans, method = \"silhouette\")+\n  labs(subtitle = \"Silhouette method\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkmeans_1 = kmeans(data_selected, 4, nstart = 20)\nkmeans_1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nK-means clustering with 4 clusters of sizes 18, 11, 13, 8\n\nCluster means:\n     Assault   UrbanPop        Rape\n1 -0.3151036  0.5844655 -0.16593620\n2  1.1875456  0.7351981  1.40005511\n3 -1.1066010 -0.9301069 -0.96676331\n4  0.8743346 -0.8145211  0.01927104\n\nClustering vector:\n       Alabama         Alaska        Arizona       Arkansas     California \n             4              2              2              4              2 \n      Colorado    Connecticut       Delaware        Florida        Georgia \n             2              1              1              2              4 \n        Hawaii          Idaho       Illinois        Indiana           Iowa \n             1              3              2              1              3 \n        Kansas       Kentucky      Louisiana          Maine       Maryland \n             1              3              4              3              2 \n Massachusetts       Michigan      Minnesota    Mississippi       Missouri \n             1              2              3              4              1 \n       Montana       Nebraska         Nevada  New Hampshire     New Jersey \n             3              3              2              3              1 \n    New Mexico       New York North Carolina   North Dakota           Ohio \n             2              2              4              3              1 \n      Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina \n             1              1              1              1              4 \n  South Dakota      Tennessee          Texas           Utah        Vermont \n             3              4              1              1              3 \n      Virginia     Washington  West Virginia      Wisconsin        Wyoming \n             1              1              3              3              1 \n\nWithin cluster sum of squares by cluster:\n[1] 16.371159 14.194571  8.421711  5.818560\n (between_SS / total_SS =  69.5 %)\n\nAvailable components:\n\n[1] \"cluster\"      \"centers\"      \"totss\"        \"withinss\"     \"tot.withinss\"\n[6] \"betweenss\"    \"size\"         \"iter\"         \"ifault\"      \n```\n:::\n\n```{.r .cell-code}\nkmeans_1$betweenss\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 102.194\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf = cbind(data_selected, cluster = kmeans_1$cluster)\n\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Assault   UrbanPop         Rape cluster\nAlabama    0.7828393 -0.5209066 -0.003416473       4\nAlaska     1.1068225 -1.2117642  2.484202941       2\nArizona    1.4788032  0.9989801  1.042878388       2\nArkansas   0.2308680 -1.0735927 -0.184916602       4\nCalifornia 1.2628144  1.7589234  2.067820292       2\nColorado   0.3988593  0.8608085  1.864967207       2\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkmeans_2 = kmeans(data_selected, 5, nstart = 20)\nkmeans_2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nK-means clustering with 5 clusters of sizes 13, 11, 5, 8, 13\n\nCluster means:\n      Assault    UrbanPop       Rape\n1 -1.10660100 -0.93010687 -0.9667633\n2  1.18754560  0.73519807  1.4000551\n3  1.07322427 -1.14267844 -0.2084049\n4 -0.57309024  1.06806582 -0.4798543\n5  0.04164707  0.09023663  0.1575520\n\nClustering vector:\n       Alabama         Alaska        Arizona       Arkansas     California \n             3              2              2              3              2 \n      Colorado    Connecticut       Delaware        Florida        Georgia \n             2              4              5              2              5 \n        Hawaii          Idaho       Illinois        Indiana           Iowa \n             4              1              2              5              1 \n        Kansas       Kentucky      Louisiana          Maine       Maryland \n             5              1              5              1              2 \n Massachusetts       Michigan      Minnesota    Mississippi       Missouri \n             4              2              1              3              5 \n       Montana       Nebraska         Nevada  New Hampshire     New Jersey \n             1              1              2              1              4 \n    New Mexico       New York North Carolina   North Dakota           Ohio \n             2              2              3              1              4 \n      Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina \n             5              5              4              4              3 \n  South Dakota      Tennessee          Texas           Utah        Vermont \n             1              5              5              4              1 \n      Virginia     Washington  West Virginia      Wisconsin        Wyoming \n             5              5              1              1              5 \n\nWithin cluster sum of squares by cluster:\n[1]  8.421711 14.194571  2.616274  4.873222  8.006551\n (between_SS / total_SS =  74.1 %)\n\nAvailable components:\n\n[1] \"cluster\"      \"centers\"      \"totss\"        \"withinss\"     \"tot.withinss\"\n[6] \"betweenss\"    \"size\"         \"iter\"         \"ifault\"      \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkmeans_3 = kmeans(data_scaled, 4, nstart = 20)\nkmeans_3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nK-means clustering with 4 clusters of sizes 8, 13, 13, 16\n\nCluster means:\n      Murder    Assault   UrbanPop        Rape\n1  1.4118898  0.8743346 -0.8145211  0.01927104\n2 -0.9615407 -1.1066010 -0.9301069 -0.96676331\n3  0.6950701  1.0394414  0.7226370  1.27693964\n4 -0.4894375 -0.3826001  0.5758298 -0.26165379\n\nClustering vector:\n       Alabama         Alaska        Arizona       Arkansas     California \n             1              3              3              1              3 \n      Colorado    Connecticut       Delaware        Florida        Georgia \n             3              4              4              3              1 \n        Hawaii          Idaho       Illinois        Indiana           Iowa \n             4              2              3              4              2 \n        Kansas       Kentucky      Louisiana          Maine       Maryland \n             4              2              1              2              3 \n Massachusetts       Michigan      Minnesota    Mississippi       Missouri \n             4              3              2              1              3 \n       Montana       Nebraska         Nevada  New Hampshire     New Jersey \n             2              2              3              2              4 \n    New Mexico       New York North Carolina   North Dakota           Ohio \n             3              3              1              2              4 \n      Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina \n             4              4              4              4              1 \n  South Dakota      Tennessee          Texas           Utah        Vermont \n             2              1              3              4              2 \n      Virginia     Washington  West Virginia      Wisconsin        Wyoming \n             4              4              2              2              4 \n\nWithin cluster sum of squares by cluster:\n[1]  8.316061 11.952463 19.922437 16.212213\n (between_SS / total_SS =  71.2 %)\n\nAvailable components:\n\n[1] \"cluster\"      \"centers\"      \"totss\"        \"withinss\"     \"tot.withinss\"\n[6] \"betweenss\"    \"size\"         \"iter\"         \"ifault\"      \n```\n:::\n:::\n\n\n## 7. Visualizing clusters with 4 and 5 clusters\n\nWe use two different dataframes, data_selected and data_scaled for our clustering with 4 and 5 clusters. The variables without removing murder variable (data_scaled) for high correlation with assault variable has a better cluster visualization. In this case, using PCA would be really useful in creating new variable with less correlation without losing most information.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_cluster(kmeans_1, data = data_selected,\n             palette=c(\"red\", \"blue\", \"black\", \"darkgreen\"),\n             ellipse.type = \"euclid\",\n             star.plot = T,\n             repel = T,\n             ggtheme = theme())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfviz_cluster(kmeans_2, data = data_selected,\n             palette=c(\"red\", \"blue\", \"black\", \"darkgreen\", \"yellow\"),\n             ellipse.type = \"euclid\",\n             star.plot = T,\n             repel = T,\n             ggtheme = theme())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n\n```{.r .cell-code}\nfviz_cluster(kmeans_3, data = data_scaled,\n             palette=c(\"red\", \"blue\", \"black\", \"darkgreen\"),\n             ellipse.type = \"euclid\",\n             star.plot = T,\n             repel = T,\n             ggtheme = theme())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-3.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}